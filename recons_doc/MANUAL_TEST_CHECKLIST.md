# 手動測試檢查清單 - 管理員介面重構

**重構範圍**: Priority 1A, 1B, 2C, 2D
**測試日期**: _________
**測試者**: _________

---

## 🎯 測試目標

驗證重構後的管理員介面功能完全正常,沒有破壞現有功能。

### 重構內容摘要

✅ **Priority 1A**: 統一能源類別配置 (energyConfig.ts)
✅ **Priority 1B**: 統一 API 轉換邏輯 (userTransformers.ts)
✅ **Priority 2C**: 簡化統計邏輯 (只用 metrics API)
✅ **Priority 2D**: 抽取匯出邏輯 (useUserExport hook)

---

## ✅ 測試前準備

### 1. 啟動開發環境

```bash
# 終端機 1: 啟動後端
cd backend
python app.py

# 終端機 2: 啟動前端
cd frontend
npm run dev
```

### 2. 準備測試帳號

- [ ] 管理員帳號: `admin@example.com`
- [ ] 一般用戶帳號 (至少 3 個測試用戶)
- [ ] 確認測試用戶有填報資料

### 3. 確認測試環境

- [ ] 瀏覽器: Chrome/Firefox (最新版)
- [ ] 開啟 DevTools Console (查看錯誤)
- [ ] 清除 Cache 和 Cookies

---

## 📋 測試案例

### 🟦 A. 管理員儀表板 (AdminDashboard)

#### A1. 統計數據顯示 (Priority 2C)

**測試目的**: 驗證統計邏輯簡化後數據正確

- [ ] **A1.1** 登入管理員帳號
- [ ] **A1.2** 進入管理員儀表板 (`/app/admin`)
- [ ] **A1.3** 檢查統計卡片顯示:
  - [ ] 總用戶數 (Total Users)
  - [ ] 待審核 (Submitted)
  - [ ] 已核准 (Approved)
  - [ ] 需修正 (Rejected)
- [ ] **A1.4** 數字是否合理 (非 0 或 NaN)
- [ ] **A1.5** 開啟 DevTools Console,確認無錯誤訊息

**預期結果**:
- ✅ 所有統計數字正確顯示
- ✅ 無 Console 錯誤
- ✅ 載入速度正常 (< 2 秒)

**實際結果**: _______________

---

#### A2. 用戶列表顯示 (Priority 1B)

**測試目的**: 驗證 API → UI 轉換正確

- [ ] **A2.1** 查看用戶列表
- [ ] **A2.2** 每個用戶卡片顯示:
  - [ ] 用戶名稱
  - [ ] Email
  - [ ] 部門/公司
  - [ ] 狀態 (submitted/approved/rejected)
  - [ ] 填報筆數 (entries count)
- [ ] **A2.3** 測試搜尋功能 (輸入用戶名)
- [ ] **A2.4** 測試狀態篩選 (submitted/approved/rejected)
- [ ] **A2.5** 確認狀態顏色正確:
  - submitted: 黃色
  - approved: 綠色
  - rejected: 紅色

**預期結果**:
- ✅ 用戶資料完整顯示
- ✅ 搜尋和篩選正常運作
- ✅ 填報筆數正確 (與實際填報數一致)

**實際結果**: _______________

---

#### A3. 用戶快速匯出 (Priority 2D)

**測試目的**: 驗證匯出功能正常

- [ ] **A3.1** 點擊任一用戶卡片的「匯出」按鈕
- [ ] **A3.2** 匯出 Modal 彈出,顯示:
  - [ ] 用戶名稱
  - [ ] 公司名稱
  - [ ] 「確認匯出」按鈕
- [ ] **A3.3** 點擊「確認匯出」
- [ ] **A3.4** 觀察進度顯示:
  - [ ] "正在準備..."
  - [ ] "下載中... (X/Y)"
- [ ] **A3.5** 等待匯出完成
- [ ] **A3.6** 檢查成功訊息 Toast
- [ ] **A3.7** 驗證下載的檔案:
  - [ ] 檔案命名正確
  - [ ] 可以開啟 (ZIP 檔案)
  - [ ] 內容包含用戶填報資料

**預期結果**:
- ✅ Modal 正常開關
- ✅ 進度正確顯示
- ✅ 檔案成功下載
- ✅ 檔案內容正確

**實際結果**: _______________

**測試匯出中關閉 Modal**:
- [ ] **A3.8** 重新匯出,在匯出過程中點擊「關閉」
- [ ] **A3.9** 確認 Modal **不會關閉** (保護機制)

**預期結果**:
- ✅ 匯出中無法關閉 Modal

**實際結果**: _______________

---

### 🟩 B. 建立用戶 (CreateUser)

#### B1. 建立新用戶 (Priority 1B)

**測試目的**: 驗證表單 → API 轉換正確

- [ ] **B1.1** 點擊「新增用戶」按鈕
- [ ] **B1.2** 進入建立用戶頁面 (`/app/admin/create`)
- [ ] **B1.3** 填寫表單:
  - [ ] 用戶名稱: `測試用戶_${時間戳}`
  - [ ] Email: `test${時間戳}@example.com`
  - [ ] 密碼: `TestPass123`
  - [ ] 公司: `測試公司`
  - [ ] 目標年度: `2024`
  - [ ] 能源類別: 勾選 `柴油`、`汽油`
  - [ ] 柴油發電機版本: `refuel`
- [ ] **B1.4** 點擊「建立用戶」
- [ ] **B1.5** 等待成功訊息
- [ ] **B1.6** 自動返回管理員儀表板
- [ ] **B1.7** 確認新用戶出現在列表中

**預期結果**:
- ✅ 表單驗證正常
- ✅ 成功建立用戶
- ✅ 新用戶出現在列表
- ✅ 無 Console 錯誤

**實際結果**: _______________

**測試表單驗證**:
- [ ] **B1.8** 嘗試提交空表單
- [ ] **B1.9** 確認顯示錯誤訊息
- [ ] **B1.10** 輸入錯誤格式 Email
- [ ] **B1.11** 確認 Email 驗證錯誤

**預期結果**:
- ✅ 表單驗證阻止提交
- ✅ 錯誤訊息清晰

**實際結果**: _______________

---

### 🟨 C. 編輯用戶 (EditUser)

#### C1. 編輯用戶資料 (Priority 1B)

**測試目的**: 驗證 API → 表單、表單 → API 雙向轉換

- [ ] **C1.1** 從儀表板點擊任一用戶的「編輯」按鈕
- [ ] **C1.2** 進入編輯頁面 (`/app/admin/edit/:userId`)
- [ ] **C1.3** 確認表單自動填入現有資料:
  - [ ] 用戶名稱
  - [ ] Email
  - [ ] 公司
  - [ ] 目標年度
  - [ ] 能源類別 (勾選狀態)
  - [ ] 柴油發電機版本
- [ ] **C1.4** 修改部分欄位:
  - [ ] 改變公司名稱
  - [ ] 增加一個能源類別
  - [ ] 改變目標年度
- [ ] **C1.5** 點擊「儲存變更」
- [ ] **C1.6** 等待成功訊息
- [ ] **C1.7** 返回儀表板
- [ ] **C1.8** 確認用戶資料已更新

**預期結果**:
- ✅ 表單正確填入現有資料
- ✅ 修改成功儲存
- ✅ 儀表板反映變更
- ✅ 無資料遺失

**實際結果**: _______________

**測試密碼更新**:

**如何重設密碼**:
- 編輯頁面有「重設密碼」欄位 (password 類型,會遮罩輸入)
- **留空** = 不更改密碼 (保持原密碼)
- **輸入新密碼** = 更新為新密碼
- 欄位下方會顯示灰色提示: "輸入新密碼以重設,留空則保持原密碼不變"

- [ ] **C1.9** 重新進入編輯頁面
- [ ] **C1.10** 檢查密碼欄位:
  - [ ] 欄位為空
  - [ ] 顯示 placeholder: "留空則不更改密碼"
  - [ ] 顯示灰色說明文字
- [ ] **C1.11** **保持密碼欄位空白**
- [ ] **C1.12** 修改其他欄位 (例如公司名稱)
- [ ] **C1.13** 點擊「儲存變更」
- [ ] **C1.14** 確認儲存成功

**預期結果**:
- ✅ 空密碼不會更新用戶密碼
- ✅ 其他欄位正常儲存

**實際結果**: _______________

- [ ] **C1.15** 重新進入編輯頁面
- [ ] **C1.16** 在密碼欄位**輸入新密碼**: `NewPass123`
- [ ] **C1.17** 確認密碼顯示為 `•••••••••••` (遮罩)
- [ ] **C1.18** 點擊「儲存變更」
- [ ] **C1.19** 等待成功訊息
- [ ] **C1.20** 登出並嘗試用新密碼登入該用戶 (如可測試)

**預期結果**:
- ✅ 密碼成功更新
- ✅ 新密碼可以登入
- ✅ 密碼輸入時正確遮罩

**實際結果**: _______________

---

#### C2. 編輯頁面變更追蹤

**測試目的**: 驗證變更偵測與提示

- [ ] **C2.1** 進入編輯頁面
- [ ] **C2.2** 修改任一欄位
- [ ] **C2.3** 確認頁面顯示「變更摘要」區塊
- [ ] **C2.4** 變更摘要顯示修改的欄位
- [ ] **C2.5** 嘗試離開頁面 (不儲存)
- [ ] **C2.6** 確認出現「未儲存變更」警告

**預期結果**:
- ✅ 變更追蹤正常
- ✅ 離開警告運作
- ✅ 防止資料遺失

**實際結果**: _______________

---

### 🟪 D. 能源類別顯示 (Priority 1A)

#### D1. 能源類別名稱統一

**測試目的**: 驗證 energyConfig.ts 正確運作

- [ ] **D1.1** 在管理員儀表板檢查用戶卡片
- [ ] **D1.2** 確認能源類別名稱顯示一致:
  - [ ] 柴油 → "柴油"
  - [ ] 汽油 → "汽油"
  - [ ] WD-40 → "WD-40"
  - [ ] 乙炔 → "乙炔"
  - [ ] 等等...
- [ ] **D1.3** 進入編輯頁面
- [ ] **D1.4** 確認能源類別勾選框標籤一致
- [ ] **D1.5** 進入建立頁面
- [ ] **D1.6** 確認能源類別選項一致

**預期結果**:
- ✅ 所有頁面能源名稱統一
- ✅ 無重複或錯誤名稱
- ✅ 中文顯示正確

**實際結果**: _______________

---

## 🔍 進階測試

### E1. 錯誤處理測試

**測試網路錯誤處理**:
- [ ] **E1.1** 開啟 DevTools Network 分頁
- [ ] **E1.2** 將網路設為「Offline」
- [ ] **E1.3** 嘗試載入儀表板
- [ ] **E1.4** 確認顯示錯誤訊息
- [ ] **E1.5** 恢復網路
- [ ] **E1.6** 點擊「重試」按鈕
- [ ] **E1.7** 確認資料正常載入

**預期結果**:
- ✅ 錯誤訊息友善
- ✅ 重試機制運作
- ✅ 無白畫面

**實際結果**: _______________

---

### E2. 效能測試

**測試載入效能**:
- [ ] **E2.1** 清除 Cache
- [ ] **E2.2** 重新整理儀表板
- [ ] **E2.3** 記錄載入時間 (DevTools Performance)
- [ ] **E2.4** 確認統計數據快取機制運作

**預期結果**:
- ✅ 首次載入 < 3 秒
- ✅ 後續載入 < 1 秒 (快取)
- ✅ 無明顯延遲

**實際結果**: _______________

---

### E3. 瀏覽器相容性

**測試不同瀏覽器**:
- [ ] **E3.1** Chrome 測試
- [ ] **E3.2** Firefox 測試
- [ ] **E3.3** Edge 測試
- [ ] **E3.4** Safari 測試 (如可用)

**預期結果**:
- ✅ 所有瀏覽器功能一致
- ✅ 無樣式錯亂

**實際結果**: _______________

---

## ❌ 已知問題 (測試前)

以下是重構**未修改**的既有問題,測試時可忽略:

1. **TypeScript 編譯錯誤** (與重構無關)
   - `AdminDashboard.tsx:218` - status 型別不匹配
   - `AdminDashboard.tsx:382,388,391` - created_at/review_notes 屬性不存在
   - 這些是其他模組的既有問題

2. **其他頁面錯誤** (未重構範圍)
   - Category1 能源頁面的各種 null 型別錯誤
   - 這些頁面未在本次重構範圍內

---

## ✅ 測試完成確認

### 整體評估

- [ ] **所有關鍵功能正常** (A1-D1)
- [ ] **無新增 Console 錯誤**
- [ ] **無功能回歸問題**
- [ ] **效能無明顯下降**

### 發現的問題

| 編號 | 嚴重程度 | 問題描述 | 重現步驟 | 截圖 |
|-----|---------|---------|---------|------|
| 1   | 🔴/🟡/🟢 |         |         |      |
| 2   | 🔴/🟡/🟢 |         |         |      |
| 3   | 🔴/🟡/🟢 |         |         |      |

**嚴重程度說明**:
- 🔴 Critical: 功能完全無法使用,阻擋發布
- 🟡 Major: 影響使用體驗,建議修復
- 🟢 Minor: 小問題,可以之後修復

---

## 📝 測試結論

**測試結果**: ✅ 通過 / ⚠️ 有問題 / ❌ 失敗

**測試時間**: _______ 至 _______

**測試者簽名**: _____________

**備註**:
_______________________________________________
_______________________________________________
_______________________________________________

---

**下一步**:
- [ ] 如果測試通過 → 可以合併到 main 分支
- [ ] 如果有問題 → 回報給開發者修復
- [ ] 記錄測試結果到 GitHub Issue 或 Notion
